(function(t,s,k){var m={},j=0,i=function(a){var b=[],c=j++,d=k,f=this,a=a||{},e=a.name||"Track"+Date.now();this.getName=function(){return e};this.getId=function(){return c};this.getTrackEvent=function(a){for(var h=0,c=b.length;h<c;++h)if(b[h].getId()===a||b[h].getName()===a)return b[h]};this.getTrackEvents=function(){return b};this.removeTrackEvent=function(a){typeof a==="string"&&(a=f.getTrackEvent(a));var h=b.indexOf(a);if(h>-1)b.splice(h,1),a.track=k,a.setButter(k),d.trigger("trackeventremoved",
a)};this.addTrackEvent=function(a){a instanceof g||(a=new g(a));b.push(a);a.track=f;a.setButter(d);return a};this.setButter=function(a){if(d=a){d.trigger("trackadded",f);for(var a=f.getTrackEvents(),b=0,h=a.length;b<h;++b)a[b].setButter(d)}};this.getButter=function(){return d};this.importJSON=function(a){if(a.name)e=a.name;if(a.trackEvents)for(var a=a.trackEvents,b=0,h=a.length;b<h;++b){var c=new g;c.importJSON(a[b]);f.addTrackEvent(c)}};this.exportJSON=function(){for(var a=[],h=0,c=b.length;h<c;++h)a.push(b[h].exportJSON());
return{name:e,trackEvents:a}}},b=0,g=function(a){var u=b++,c=k,d=this,a=a||{},f=a.name||"Track"+Date.now();this.start=a.start||0;this.end=a.end||0;this.type=a.type;this.popcornOptions=a.popcornOptions;this.popcornEvent=a.popcornEvent;this.track=a.track;this.getName=function(){return f};this.getId=function(){return u};this.setButter=function(a){(c=a)&&c.trigger("trackeventadded",d)};this.getButter=function(){return c};this.importJSON=function(a){this.start=a.start||0;this.end=a.end||0;this.type=a.type;
if(a.name)f=a.name;this.popcornOptions=a.popcornOptions};this.exportJSON=function(){return{start:this.start,end:this.end,type:this.type,popcornOptions:this.popcornOptions,track:this.track?this.track.getName():k,name:f}}},d=0,a=function(a){var b=d++,a=a||{},c=a.name||"Target"+b+Date.now();this.object=a.object;this.getName=function(){return c};this.getId=function(){return b};this.importJSON=function(a){if(a.name)c=a.name;this.object=a.object};this.exportJSON=function(){var a;try{a=JSON.stringify(this.object)}catch(b){a=
this.object.toString()}return{name:c,object:a}}},e=0,l=function(a){var a=a||{},b={},c=[],d=e++,f=a.name||"Media"+d+Date.now(),g,l,n=k,q=0,j=0,o=this;this.getUrl=function(){return g};this.getTarget=function(){return l};this.setUrl=function(a){g=a;n&&n.trigger("mediacontentchanged",o)};this.setTarget=function(a){l=a;n&&n.trigger("mediatargetchanged",o)};this.getName=function(){return f};this.getId=function(){return d};this.getTracks=function(){return c};this.setButter=function(a){if(n=a){n.trigger("mediaadded",
o);for(var a=o.getTracks(),b=0,h=a.length;b<h;++b)a[b].setButter(n)}};this.getButter=function(){return n};this.addTrack=function(a){a instanceof i||(a=new i(a));b[a.getName()]=a;c.push(a);a.setButter(n);return a};this.getTrack=function(a){var o=b[a];if(o)return o;for(var o=0,h=c.length;o<h;++o)if(c[o].getName()===a)return c[o];return k};this.removeTrack=function(a){typeof a==="string"&&(a=o.getTrack(a));var h=c.indexOf(a);if(h>-1){c.splice(h,1);a.setButter(k);delete b[a.getName()];for(var h=a.getTrackEvents(),
f=0,d=h.length;f<d;++f)n.trigger("trackeventremoved",h[f]);n&&n.trigger("trackremoved",a);return a}return k};this.currentTime=function(a){a&&(q=a,n&&n.trigger("mediatimeupdate",o));return q};this.duration=function(a){a&&(j=a,n&&n.trigger("mediadurationchanged",o));return j};this.importJSON=function(a){if(a.name)f=a.name;a.target&&o.setTarget(a.target);a.url&&o.setUrl(a.url);if(a.tracks)for(var a=a.tracks,b=0,h=a.length;b<h;++b){var c=new i;c.importJSON(a[b]);o.addTrack(c)}};this.exportJSON=function(){for(var a=
[],o=0,b=c.length;o<b;++o)a.push(c[o].exportJSON());return{name:f,url:g,target:l,duration:j,tracks:a}};a.url&&this.setUrl(a.url);a.target&&this.setTarget(a.target)},q=0,f=function(){function b(){if(!e)throw Error("No media object is selected");}var f={},c=[],d={},e,i=[],v={},n={},r=this;this.id="Butter"+q++;this.trigger=function(a,b,c){b={type:a,domain:c,data:b};if(f[a])for(var h=0,d=f[a].length;h<d;++h)f[a][h].call(r,b,c);if(c&&(a+=c,f[a])){h=0;for(d=f[a].length;h<d;++h)f[a][h].call(r,b,c)}};this.listen=
function(a,b,h){a+=h||"";f[a]||(f[a]=[]);f[a].push(b)};this.unlisten=function(a,b,h){a+=h||"";if(h=f[a])b?(a=h.indexOf(b),h.splice(a,1)):f[a]=[]};this.addTrackEvent=function(a,c){b();typeof a==="string"&&(a=e.getTrack(a));if(a)return c instanceof g||(c=new g(c)),a.addTrackEvent(c),c;else throw Error("No valid track specified");};this.getTrackEvents=function(){b();for(var a=e.getTracks(),c={},f=0,d=a.length;f<d;++f){var g=a[f];c[g.getName()]=g.getTrackEvents()}return c};this.getTrackEvent=function(a,
c){b();if(a&&c)return typeof a==="string"&&(a=r.getTrack(a)),a.getTrackEvent(c);else{var f=r.getTrackEvents(),d;for(d in f)for(var e=f[d],g=0,u=e.length;g<u;++g)if(e[g].getName()===a)return e[g]}};this.removeTrackEvent=function(a,c){b();if(!c)if(a instanceof g)c=a,a=c.track;else if(typeof a==="string")c=r.getTrackEvent(a),a=c.track;else throw Error("Invalid parameters for removeTrackEvent");typeof a==="string"&&(a=r.getTrack(a));typeof c==="string"&&(c=a.getTrackEvent(c));a.removeTrackEvent(c);return c};
this.addTrack=function(a){b();return e.addTrack(a)};this.getTracks=function(){b();return e.getTracks()};this.getTrack=function(a){b();return e.getTrack(a)};this.removeTrack=function(a){b();return e.removeTrack(a)};this.addTarget=function(b){b instanceof a||(b=new a(b));v[b.getName()]=b;i.push(b);r.trigger("targetadded",b);return b};this.removeTarget=function(a){typeof a==="string"&&(a=r.getTarget(a));var b=i.indexOf(a);if(b>-1)return i.splice(b,1),delete i[a.getName()],r.trigger("targetremoved",a),
a;return k};this.getTargets=function(a){if(a){for(var a=[],b=0,c=i.length;b<c;++b)a.push(i[b].exportJSON());return a}else return i};this.getTarget=function(a){return v[a]};this.importProject=function(b){n=b.project;if(b.targets)for(var c=0,h=b.targets.length;c<h;++c){var f=new a;f.importJSON(b.targets[c]);r.addTarget(f)}if(b.media){c=0;for(h=b.media.length;c<h;++c)f=new l,f.importJSON(b.media[c]),r.addMedia(f)}};this.exportProject=function(){for(var a=[],b=0,h=c.length;b<h;++b)a.push(c[b].exportJSON());
return{project:n,targets:r.getTargets(!0),media:a}};this.setProjectDetails=function(a,b){n[a]=b};this.getProjectDetails=function(a){return a?n[a]:n};this.currentTime=function(a){b();return e.currentTime(a)};this.duration=function(a){b();return e.duration(a)};this.getAllMedia=function(){return c};this.getMedia=function(a){if(d[a])return d[a];for(var b=0,h=c.length;b<h;++b)if(c[b].getName()===a)return c[b];return k};this.getCurrentMedia=function(){return e};this.setMedia=function(a){typeof a==="string"&&
(a=r.getMedia(a));if(a&&c.indexOf(a)>-1)return e=a,r.trigger("mediachanged",a),e};this.addMedia=function(a){a instanceof l||(a=new l(a));var b=a.getName();c.push(a);d[b]=a;a.setButter(r);e||r.setMedia(a);return a};this.removeMedia=function(a){typeof a==="string"&&(a=r.getMedia(a));var b=c.indexOf(a);if(b>-1)return c.splice(b,1),delete d[a.getName()],a.setButter(k),a===e&&(e=k),r.trigger("mediaremoved",a),a;return k};for(var j in m)m[j].setup&&m[j].setup.call(this)};f.getScriptLocation=function(){for(var a=
s.querySelectorAll("script"),b=0;b<a.length;++b){var c=a[b].src.lastIndexOf("butter.js");if(c>-1)return a[b].src.substr(0,c)+"/"}};f.registerModule=f.prototype.registerModule=function(a,b){f.prototype[a]=function(a){b.setup&&b.setup.call(this,a);return this};b.extend&&f.extendAPI(b.extend)};f.extendAPI=function(a){for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b],f.prototype[b]=a[b])};f.extend=function(a){var b=a;[].slice.call(arguments,1).forEach(function(a){for(var f in a)b[f]=a[f]})};f.Media=l;f.Track=
i;f.TrackEvent=g;f.Target=a;t.Butter=f})(window,document,void 0);(function(t,s,k,m){m.registerModule("comm",{setup:function(){},extend:{CommClient:function(j,i){var b={};t.addEventListener("message",function(g){if(g.source!==t){g=JSON.parse(g.data);if(g.type&&b[g.type])for(var d=b[g.type],a=0;a<d.length;++a)d[a](g.message);i&&i(g)}},!1);this.listen=function(g,d){if(g&&d)return b[g]||(b[g]=[]),b[g].push(d),d;else throw Error("Must provide a type and callback for CommClient listeners");};this.forget=function(g,d){if(d){var a=b[g].indexOf(d);if(a>-1)return d=b[g][a],
b.splice(a,1),d}else delete b[g]};this.send=function(b,d){d?postMessage(JSON.stringify({type:d,message:b}),"*"):postMessage(JSON.stringify(b),"*")}},CommServer:function(){function j(b,d,a){var e={};this.getName=function(){return b};this.listen=function(a,b){if(a&&b)return e[a]||(e[a]=[]),e[a].push(b),b;else throw Error("Must provide a type and callback for CommServer listeners");};this.forget=function(a,b){if(b){var f=e[a].indexOf(b);if(f>-1)return b=e[a][f],e.splice(f,1),b}else delete e[a]};this.send=
function(a,b){b?d.postMessage(JSON.stringify({type:b,message:a}),"*"):d.postMessage(JSON.stringify(a),"*")};d.addEventListener("message",function(b){if(b.source===d){b=JSON.parse(b.data);if(b.type&&e[b.type])for(var g=e[b.type],f=0;f<g.length;++f)g[f](b.message);a&&a(b)}},!1)}var i={},b=this;this.bindFrame=function(g,d,a,e){d.addEventListener("load",function(l){b.bindClientWindow(g,d.contentWindow,e);a&&a(l)},!1)};this.bindWindow=function(g,d,a,e){d.addEventListener("load",function(l){b.bindClientWindow(g,
d,e);a&&a(l)},!1)};this.bindClientWindow=function(b,d,a){i[b]=new j(b,d,a)};this.listen=function(b,d,a){i[b]&&i[b].listen(d,a)};this.forget=function(b,d,a){i[b]&&i[b].forget(d,a)};this.send=function(b,d,a){i[b]&&i[b].send(d,a)}}}})})(window,document,void 0,Butter);(function(t,s,k,m){m.registerModule("plugintray",function(){var j=[],i=0,b,g=function(b){var a=i++,e=k,b=b||{},g=b.name||"Plugin"+Date.now();this.type=b.type;this.getName=function(){return g};this.getId=function(){return a};this.setButter=function(a){e=a};this.getButter=function(){return e}};return{setup:function(d){d=d||{};b=s.getElementById(d.target)||d.target},extend:{addPlugin:function(d){d instanceof g||(d=new g(d));j.push(d);d.setButter(this);this.trigger("pluginadded",d);var a=s.createElement("span");
a.innerHTML=d.type+" ";a.id=d.type;a.setAttribute("data-trackliner-type","butterapp");$(a).draggable({helper:"clone",appendTo:"body",zIndex:9001,revert:!0,revertDuration:0});b.appendChild(a);return d},getPlugins:function(){return j}}}}())})(window,document,void 0,Butter);(function(t,s,k,m){k.registerModule("eventeditor",function(){var j,i,b,g,d,a,e,l={},q=function(f){function u(){g[b]("editorCommLink",c,function(){p.listen("trackeventupdated",k);p.listen("targetadded",function(){g.send("editorCommLink",p.getTargets(),"updatedomtargets")});g.listen("editorCommLink","okayclicked",function(a){f.popcornOptions=a;c.close&&c.close();c&&c.parentNode&&c.parentNode.removeChild(c);p.unlisten("trackeventupdated",k);p.trigger("trackeditclosed");p.trigger("trackeventupdated",
f)});g.listen("editorCommLink","applyclicked",function(a){f.popcornOptions=a;p.trigger("trackeventupdated",f)});g.listen("editorCommLink","deleteclicked",function(){p.removeTrackEvent(f);c.close&&c.close();c&&c.parentNode&&c.parentNode.removeChild(c);p.unlisten("trackeventupdated",k);p.trigger("trackeditclosed")});g.listen("editorCommLink","cancelclicked",function(){c.close&&c.close();c&&c.parentNode&&c.parentNode.removeChild(c);p.unlisten("trackeventupdated",k);p.trigger("trackeditclosed")});for(var a=
p.getTargets(),b=[],d=0,e=a.length;d<e;++d)b.push([a[d].getName(),a[d].getId()]);g.send("editorCommLink",{trackEvent:f,targets:b},"edittrackevent")})}var c,p=this,q=l[f.type]||f.manifest.customEditor||i,k=function(a){g.send("editorCommLink",a.data.popcornOptions,"updatetrackevent")};if(j)for(;j.firstChild;)j.removeChild(j.firstChild);if(b==="bindWindow")c=e||t.open(q,"","width="+a+",height="+d+",menubar=no,toolbar=no,location=no,status=no"),u(),c.addEventListener("beforeunload",function(){p.unlisten("trackeventupdated",
k);p.trigger("trackeditforcedclosed")},!1);else if(b==="bindFrame")c=s.createElement("iframe"),c.style.width=a,c.style.height=d,u(),c.src=q,j.appendChild(c)},f=function(a,b){return{domtarget:function(a){if(typeof a==="string")return j=s.getElementById(a)||{};else if(a)return j=a},window:function(a){if(a)return e=a}}[b](a)};return{setup:function(h){if(!h||typeof h!=="object")throw Error("Invalid Argument");a=h.editorWidth||400;d=h.editorHeight||400;h.target&&f(h.target,"domtarget")||h.targetWindow&&
f(h.targetWindow,"window");b=j?"bindFrame":"bindWindow";i=h.defaultEditor||"defaultEditor.html";g=new k.CommServer},extend:{editTrackEvent:function(a){if(!a||!(a instanceof k.TrackEvent))return!1;this.trigger("trackeditstarted");q.call(this,a);return!0},addCustomEditor:function(a,b){if(!b||!a)return!1;return l[b]=a},removeCustomEditor:function(a,b){if(!b||!a)return!1;var f=l[b];l[b]=m;return f},changeEditorTarget:function(a,d){var c=["domtarget","window"],e;if(!a)return j=m,b="bindWindow",!0;if(!d||
c.indexOf(e=d.toLowerCase())===-1)return!1;return f(a,e)},setDefaultEditor:function(a){if(!a||typeof a!=="string")return!1;return i=a},setEditorDims:function(b){if(!b||!b.height&&!b.width)return!1;a=b.width||a;d=b.height||d;return b}}}}())})(window,window.document,Butter);(function(t,s,k,m){var j,i,b,g,d,a,e,l,q;m.registerModule("previewer",{setup:function(f){l={};e=f.popcornURL||"http://popcornjs.org/code/dist/popcorn-complete.js";j=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/;layout=f.layout;butterIds={};d=f.media;q={};a={};var h=this,g=s.getElementById(f.target);if(g.tagName==="DIV")target=s.getElementById(f.target),b=s.createElement("IFRAME"),b.src=layout,b.width=target.style.width,b.height=target.style.height,target.appendChild(b),
b.addEventListener("load",function(){h.scraper(b,f.callback);this.removeEventListener("load",arguments.callee,!1)},!1);else if(g.tagName==="IFRAME")b=g,b.src=f.layout,g.addEventListener("load",function(){h.scraper(b,f.callback);this.removeEventListener("load",arguments.callee,!1)},!1)},extend:{scraper:function(a,b){function e(a){for(var b=0;b<a.length;b++)a[b].getAttribute("data-butter")==="target"?that.addTarget({name:a[b].id,type:"target"}):a[b].getAttribute("data-butter")==="media"&&that.addMedia({target:a[b].id,
url:d}),a[b].children.length>0&&e(a[b].children)}var c=(a.contentWindow||a.contentDocument).document.getElementsByTagName("BODY");that=this;m.extend(l,(a.contentWindow||a.contentDocument).document.head);var g=function(){c.length<1?setTimeout(function(){g()},5):(e(c[0].children),b())};g()},buildPopcorn:function(f,d){i=f.getUrl();var e=(b.contentWindow||b.contentDocument).document;videoTarget=f.getTarget();e.getElementById(videoTarget).innerHTML="";g="document.addEventListener('DOMContentLoaded', function () {\n";
var c=j.exec(i)||"",l=[];l.youtu=function(){e.getElementById(videoTarget).innerHTML="";a[f.getId()]="popcorn"+f.getId()+" = Popcorn( Popcorn.youtube( '"+videoTarget+"', '"+i+"', {\nwidth: 430, height: 300\n} ) );\n"};l["vimeo "]=function(){e.getElementById(videoTarget).innerHTML="";a[f.getId()]="popcorn"+f.getId()+" = Popcorn( Popcorn.vimeo( '"+videoTarget+"', '"+i+"', {\ncss: {\nwidth: '430px',\nheight: '300px'\n}\n} ) );\n"};l.soundcloud=function(){e.getElementById(videoTarget).innerHTML="";a[f.getId()]=
"popcorn"+f.getId()+" = Popcorn( Popcorn.soundcloud( '"+videoTarget+"', '"+i+"' ) );\n"};l.baseplayer=function(){e.getElementById(videoTarget).innerHTML="";a[f.getId()]="popcorn"+f.getId()+" = Popcorn( Popcorn.baseplayer( '"+videoTarget+"' ) );\n"};l[k]=function(){var b=e.createElement("source"),c=e.createElement("video");b.src=i;c.style.width=e.getElementById(videoTarget).style.width;c.style.height=e.getElementById(videoTarget).style.height;c.appendChild(b);c.controls=!0;c.id=videoTarget+"-butter";
e.getElementById(videoTarget).appendChild(c);b="#"+c.id;a[f.getId()]="popcorn"+f.getId()+" = Popcorn( '"+b+"');\n"};l[c[1]]();for(video in a)g+=a[video];for(popcorn in q)if(c=q[popcorn].getTrackEvents())for(l=0;l<c.length;l++){var m=c[l]._natives.manifest.options;g+=" popcorn"+popcorn+"."+c[l]._natives.type+"({\n";for(item in m)m.hasOwnProperty(item)&&(g+=item+": '"+c[l][item]+"',\n");g+="});"}g+="}, false);";this.fillIframe(f,d)},getPopcorn:function(){var b="var "+a;for(popcorn in q){var e=q[popcorn].getTrackEvents();
if(e)for(var d=0;d<e.length;d++){var c=e[d]._natives.manifest.options;b+="popcorn"+popcorn+"."+e[d]._natives.type+"({\n";for(item in c)c.hasOwnProperty(item)&&(b+=item+": '"+e[d][item]+"',\n");b+="});\n"}}return b},getRegistry:function(){return(b.contentWindow||b.contentDocument).Popcorn.registry},fillIframe:function(a,d){var i,c,k=this,j=(b.contentWindow||b.contentDocument).document;i=j.createElement("script");i.innerHTML=g;j.head.appendChild(i);i="<head>"+l.innerHTML+"\n<script src='"+e+"'><\/script>\n<script>\n"+
g+"<\/script>";i+="\n</head>\n";c=j.body.innerHTML;j.open();j.write("<html>\n"+i+c+"\n</html>");j.close();var m=function(c,e){var d=(b.contentWindow||b.contentDocument)["popcorn"+a.getId()];d?e&&e(d):setTimeout(function(){m(c,e)},10)};m(null,function(b){var c=function(){b.media.readyState>=2||b.media.duration>0?(k.duration(b.media.duration),k.trigger("mediaready",a),b.media.addEventListener("timeupdate",function(){k.currentTime(b.media.currentTime);k.trigger("mediatimeupdate",a)},!1),d&&d()):setTimeout(function(){c(b)},
10)};c(b)});this.teAdded=function(c){var e=c.data;m(e,function(c){q[a.getId()]?c=q[a.getId()]:q[a.getId()]=c;c.removeTrackEvent(butterIds[e.getId()]);c[e.type]((b.contentWindow||b.contentDocument.parentWindow).Popcorn.extend({},e.popcornOptions));butterIds[e.getId()]=c.getLastTrackEventId();e.manifest=c.getTrackEvent(butterIds[e.getId()])._natives.manifest})};this.listen("trackeventupdated",function(a){this.teAdded(a)});this.listen("trackeventadded",function(c){c=c.data;m(c,function(e){q[a.getId()]?
e=q[a.getId()]:q[a.getId()]=e;e[c.type]((b.contentWindow||b.contentDocument).Popcorn.extend({},c.popcornOptions));butterIds[c.getId()]=e.getLastTrackEventId();c.manifest=e.getTrackEvent(butterIds[c.getId()])._natives.manifest})});this.listen("trackeventremoved",function(c){(b.contentWindow||b.contentDocument)["popcorn"+a.getId()].removeTrackEvent(butterIds[c.data.getId()])});this.listen("mediachanged",function(){k.buildPopcorn(k.getCurrentMedia())});this.listen("mediatimeupdate",function(c){c.domain===
"previewer"&&b.contentWindow["popcorn"+a.getId()].currentTime(c.data.currentTime())},"timeline")}}})})(window,document,void 0,Butter);Butter.registerModule("timeline",{setup:function(t){var s=function(a){var b=new Date(1970,0,1);b.setSeconds(a);a=b.toTimeString().substr(0,8);a>86399&&(a=Math.floor((b-Date.parse("1/1/70"))/36E5)+a.substr(2));return a},k=!1,m=0,j=function(){var a=this;this.container=document.createElement("div");this.container.style.width="100%";this.container.style.position="relative";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.oUserSelect="none";this.container.style.userSelect=
"none";g.appendChild(this.container);this.tracks=document.createElement("div");this.tracks.style.width="100%";this.init=function(){this.duration=d.duration();this.trackLine=new TrackLiner({element:this.tracks,dynamicTrackCreation:!0,scale:1,duration:this.duration,restrictToKnownPlugins:!0});this.butterTracks={};this.trackLinerTracks={};this.butterTrackEvents={};this.trackLinerTrackEvents={};this.timeline=document.createElement("canvas");this.timeline.style.height="25px";this.timeline.style.width=
this.container.offsetWidth+"px";this.timeline.height="25";this.timeline.width=this.container.offsetWidth;this.scrubber=document.createElement("div");this.scrubber.style.height="100%";this.scrubber.style.width="1px";this.scrubber.style.position="absolute";this.scrubber.style.top="0";this.scrubber.style.left="0";this.scrubber.style.zIndex=this.timeline.style.zIndex+1;this.scrubber.style.backgroundColor="red";this.userInteract=document.createElement("div");this.userInteract.style.position="absolute";
this.userInteract.style.top="0";this.userInteract.style.left="0";this.userInteract.style.height=this.timeline.style.height;this.userInteract.style.width="100%";this.userInteract.style.zIndex=this.scrubber.style.zIndex+1;this.userInteract.addEventListener("mousemove",function(a){m=a.rangeParent.scrollLeft},!1);this.userInteract.addEventListener("mousedown",function(b){k=!0;a.scrubber.style.left=b.pageX-(a.container.offsetLeft-b.rangeParent.scrollLeft);d.currentTime((b.pageX-(a.container.offsetLeft-
m)+a.container.scrollLeft)/a.container.offsetWidth*this.duration)},!1);this.container.appendChild(this.scrubber);this.container.appendChild(this.userInteract);this.container.appendChild(this.timeline);this.container.appendChild(this.tracks);var b=this.timeline.getContext("2d"),g=this.container.offsetWidth/this.duration/4,i=[10,4,7,4],f=b.measureText(s(5)).width,h=-f/2;b.translate(0.5,0.5);b.beginPath();for(var j=1,c=this.duration*4;j<c;j++){var p=j*g;b.moveTo(-~p,0);b.lineTo(-~p,i[j%4]);j%4===0&&
p-h>f&&(h=p,b.fillText(s(j/4),-~p-f/2,21))}b.stroke();b.closePath()};this.hide=function(){this.container.style.display="none"};this.show=function(){this.container.style.display="block"}},i=[],b,g=document.getElementById(t.target)||t.target,d=this;TrackLiner.plugin("butterapp",{setup:function(a,e,g,i){if(i){g=a;if(!b.butterTracks[a.id()])b.trackLine.removeTrack(g),d.addTrack(new Butter.Track),g=b.lastTrack;b.lastTrack=g;var g=e.left/b.container.offsetWidth*b.duration,f=g+4;d.addTrackEvent(b.butterTracks[b.lastTrack.id()],
new Butter.TrackEvent({popcornOptions:{start:g,end:f},type:i.draggable[0].id}))}else return g=e.popcornOptions.start,f=e.popcornOptions.end,i=(f-g)/b.duration*a.getElement().offsetWidth,{left:g/b.duration*a.getElement().offsetWidth,innerHTML:e.type,width:i}},moved:function(a,e){var g=a;e.options.popcornOptions.start=e.element.offsetLeft/b.container.offsetWidth*b.duration;e.options.popcornOptions.end=(e.element.offsetLeft+e.element.offsetWidth)/b.container.offsetWidth*b.duration;if(!b.butterTracks[a.id()])b.trackLine.removeTrack(g),
d.addTrack(new Butter.Track),g=b.lastTrack,g.addTrackEvent(e);b.lastTrack=g;d.trigger("trackeventupdated",e.options)},click:function(){},dblclick:function(a,b){d.editTrackEvent&&d.editTrackEvent(b.options)}});document.addEventListener("mousemove",function(a){if(k)a.pageX>b.container.offsetLeft-m&&a.pageX<b.container.offsetLeft-m+b.container.offsetWidth?(b.scrubber.style.left=a.pageX-(b.container.offsetLeft-m),d.currentTime((a.pageX-(b.container.offsetLeft-m)+b.container.scrollLeft)/b.container.offsetWidth*
b.duration)):a.pageX<=b.container.offsetLeft-m?(b.scrubber.style.left=0,d.currentTime(0)):(b.scrubber.style.left=b.container.offsetWidth,d.currentTime(b.duration)),d.trigger("mediatimeupdate",d,"previewer")},!1);document.addEventListener("mouseup",function(){k=!1},!1);this.listen("mediatimeupdate",function(){b.scrubber.style.left=d.currentTime()/b.duration*b.container.offsetWidth});this.listen("trackadded",function(a){var a=a.data,e=b.trackLine.createTrack();b.trackLinerTracks[a.getId()]=e;b.lastTrack=
e;b.butterTracks[e.id()]=a});this.listen("trackremoved",function(a){var a=a.data,e=b.trackLinerTracks[a.getId()],g=e.getTrackEvents(),i;for(i in g)g.hasOwnProperty(i)&&d.removeTrackEvent(a,b.butterTrackEvents[g[i].element.id]);b.trackLine.removeTrack(e);delete b.butterTracks[e.id()];delete b.trackLinerTracks[a.getId()]});this.listen("trackeventadded",function(a){var a=a.data,e=b.lastTrack.createTrackEvent("butterapp",a);b.trackLinerTrackEvents[a.getId()]=e;b.butterTrackEvents[e.element.id]=a});this.listen("trackeventremoved",
function(a){var a=a.data,e=b.trackLinerTrackEvents[a.getId()],d=b.trackLine.getTrack(e.trackId);(b.lastTrack=d)&&d.removeTrackEvent(e.element.id);delete b.butterTrackEvents[e.element.id];delete b.trackLinerTrackEvents[a.getId()]});this.listen("mediaadded",function(a){i[a.data.getId()]=new j(a.data)});this.listen("mediaready",function(a){i[a.data.getId()].init()});this.listen("mediachanged",function(a){b&&b.hide();(b=i[a.data.getId()])&&b.show()});this.listen("mediaremoved",function(a){delete i[a.data.getId()]});
this.listen("trackeventupdated",function(a){var a=a.data,d=b.trackLinerTrackEvents[a.getId()];trackLinerTrack=b.trackLine.getTrack(d.trackId);delete b.butterTrackEvents[d.element.id];trackLinerTrack.removeTrackEvent(d.element.id);d=trackLinerTrack.createTrackEvent("butterapp",a);b.butterTrackEvents[d.element.id]=a;b.trackLinerTrackEvents[a.getId()]=d})}});
